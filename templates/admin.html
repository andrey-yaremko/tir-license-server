<!DOCTYPE html>
<html>
<head>
    <title>TIR Bot - –ê–¥–º—ñ–Ω–∫–∞</title>
    <meta charset="UTF-8">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header { 
            background: #2c3e50; 
            color: white; 
            padding: 20px; 
            border-radius: 5px; 
            margin-bottom: 20px; 
        }
        .stats { 
            display: flex; 
            gap: 20px; 
            margin-bottom: 20px; 
            flex-wrap: wrap;
        }
        .stat-card { 
            background: #3498db; 
            color: white; 
            padding: 15px; 
            border-radius: 5px; 
            flex: 1; 
            text-align: center;
            min-width: 150px;
        }
        .btn { 
            background: #27ae60; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover { 
            background: #219652; 
        }
        .btn-copy {
            background: #e67e22;
        }
        .btn-copy:hover {
            background: #d35400;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px;
            font-size: 14px;
        }
        th, td { 
            padding: 12px; 
            text-align: left; 
            border-bottom: 1px solid #ddd; 
        }
        th { 
            background: #34495e; 
            color: white; 
        }
        tr:hover {
            background: #f9f9f9;
        }
        .active { 
            color: green; 
            font-weight: bold; 
        }
        .expired { 
            color: red; 
            font-weight: bold; 
        }
        .inactive {
            color: orange;
            font-weight: bold;
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        .license-key {
            font-family: monospace;
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ TIR Bot - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è</h1>
            <p>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ª—ñ—Ü–µ–Ω–∑—ñ—è–º–∏ | –°–µ—Ä–≤–µ—Ä: <span id="serverStatus">üü¢ –ü—Ä–∞—Ü—é—î</span></p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>üìä –í—Å—å–æ–≥–æ –ª—ñ—Ü–µ–Ω–∑—ñ–π</h3>
                <p id="totalLicenses">0</p>
            </div>
            <div class="stat-card">
                <h3>üü¢ –ê–∫—Ç–∏–≤–Ω–∏—Ö</h3>
                <p id="activeLicenses">0</p>
            </div>
            <div class="stat-card">
                <h3>üü° –ù–µ–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏—Ö</h3>
                <p id="inactiveLicenses">0</p>
            </div>
            <div class="stat-card">
                <h3>üî¥ –ü—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏—Ö</h3>
                <p id="expiredLicenses">0</p>
            </div>
        </div>

        <div class="controls">
            <h3>üöÄ –®–≤–∏–¥–∫—ñ –¥—ñ—ó</h3>
            <button class="btn" onclick="createLicense(30)">üÜï –°—Ç–≤–æ—Ä–∏—Ç–∏ –ª—ñ—Ü–µ–Ω–∑—ñ—é (30 –¥–Ω—ñ–≤)</button>
            <button class="btn" onclick="createLicense(7)">üÜï –°—Ç–≤–æ—Ä–∏—Ç–∏ –ª—ñ—Ü–µ–Ω–∑—ñ—é (7 –¥–Ω—ñ–≤)</button>
            <button class="btn" onclick="createLicense(1)">üÜï –°—Ç–≤–æ—Ä–∏—Ç–∏ –ª—ñ—Ü–µ–Ω–∑—ñ—é (1 –¥–µ–Ω—å)</button>
            <button class="btn" onclick="refreshLicenses()">üîÑ –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫</button>
            <button class="btn" onclick="testServer()">üß™ –¢–µ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞</button>
        </div>

        <div>
            <h3>üìã –°–ø–∏—Å–æ–∫ –ª—ñ—Ü–µ–Ω–∑—ñ–π</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ö–ª—é—á –ª—ñ—Ü–µ–Ω–∑—ñ—ó</th>
                        <th>HWID</th>
                        <th>–î–Ω—ñ–≤</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ</th>
                        <th>–°—Ç–≤–æ—Ä–µ–Ω–æ</th>
                        <th>–î—ñ—ó</th>
                    </tr>
                </thead>
                <tbody id="licensesTable">
                    <tr>
                        <td colspan="8" style="text-align: center;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
        const ADMIN_USERNAME = 'admin';
        const ADMIN_PASSWORD = 'Karnaval3e'; // ‚ö†Ô∏è –ó–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å!
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
        function getAuthHeaders() {
            const auth = btoa(`${ADMIN_USERNAME}:${ADMIN_PASSWORD}`);
            return {
                'Content-Type': 'application/json',
                'Authorization': `Basic ${auth}`
            };
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –ª—ñ—Ü–µ–Ω–∑—ñ–π
        function loadLicenses() {
            showLoading();
            
            fetch('/admin/licenses', {
                headers: getAuthHeaders()
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                }
                return response.json();
            })
            .then(licenses => {
                updateStats(licenses);
                renderLicensesTable(licenses);
            })
            .catch(error => {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª—ñ—Ü–µ–Ω–∑—ñ–π: ' + error.message);
            });
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(licenses) {
            document.getElementById('totalLicenses').textContent = licenses.length;
            document.getElementById('activeLicenses').textContent = 
                licenses.filter(l => l.status === 'active' && (!l.hwid || l.hwid === '–ù–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ')).length;
            document.getElementById('inactiveLicenses').textContent = 
                licenses.filter(l => l.status === 'active' && l.hwid && l.hwid !== '–ù–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ').length;
            document.getElementById('expiredLicenses').textContent = 
                licenses.filter(l => l.status === 'expired').length;
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –ª—ñ—Ü–µ–Ω–∑—ñ–π
        function renderLicensesTable(licenses) {
            const table = document.getElementById('licensesTable');
            
            if (licenses.length === 0) {
                table.innerHTML = '<tr><td colspan="8" style="text-align: center;">–ù–µ–º–∞—î –ª—ñ—Ü–µ–Ω–∑—ñ–π</td></tr>';
                return;
            }
            
            table.innerHTML = licenses.map(license => `
                <tr>
                    <td>${license.id}</td>
                    <td><span class="license-key">${license.license_key}</span></td>
                    <td>${license.hwid || '–ù–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ'}</td>
                    <td>${license.days}</td>
                    <td class="${getStatusClass(license.status)}">${getStatusText(license.status)}</td>
                    <td>${formatDate(license.activated_at)}</td>
                    <td>${formatDate(license.created_at)}</td>
                    <td>
                        <button class="btn btn-copy" onclick="copyKey('${license.license_key}')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
                        <button class="btn" onclick="deleteLicense(${license.id})" style="background: #e74c3c;">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
                    </td>
                </tr>
            `).join('');
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function getStatusClass(status) {
            switch(status) {
                case 'active': return 'active';
                case 'expired': return 'expired';
                default: return 'inactive';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'active': return '–ê–∫—Ç–∏–≤–Ω–∞';
                case 'expired': return '–ü—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∞';
                default: return status;
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('uk-UA');
        }

        function showLoading() {
            const table = document.getElementById('licensesTable');
            table.innerHTML = '<tr><td colspan="8" style="text-align: center;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</td></tr>';
        }

        function showError(message) {
            const table = document.getElementById('licensesTable');
            table.innerHTML = `<tr><td colspan="8" style="text-align: center; color: red;">${message}</td></tr>`;
        }

        function showMessage(message, isError = false) {
            alert(message);
        }

        // –û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function createLicense(days) {
            if (!confirm(`–°—Ç–≤–æ—Ä–∏—Ç–∏ –ª—ñ—Ü–µ–Ω–∑—ñ—é –Ω–∞ ${days} –¥–Ω—ñ–≤?`)) return;
            
            fetch('/admin/create_license', {
                method: 'POST',
                headers: getAuthHeaders(),
                body: JSON.stringify({ days: days })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                showMessage(`‚úÖ –õ—ñ—Ü–µ–Ω–∑—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–∞: ${data.license_key}`);
                loadLicenses();
            })
            .catch(error => {
                console.error('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è:', error);
                showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ª—ñ—Ü–µ–Ω–∑—ñ—ó: ' + error.message, true);
            });
        }

        function deleteLicense(licenseId) {
            if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –ª—ñ—Ü–µ–Ω–∑—ñ—é? –¶—é –¥—ñ—é –Ω–µ –º–æ–∂–Ω–∞ —Å–∫–∞—Å—É–≤–∞—Ç–∏!')) return;
            
            fetch(`/admin/delete_license/${licenseId}`, {
                method: 'DELETE',
                headers: getAuthHeaders()
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                showMessage('‚úÖ –õ—ñ—Ü–µ–Ω–∑—ñ—è –≤–∏–¥–∞–ª–µ–Ω–∞');
                loadLicenses();
            })
            .catch(error => {
                console.error('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è:', error);
                showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ª—ñ—Ü–µ–Ω–∑—ñ—ó: ' + error.message, true);
            });
        }

        function copyKey(key) {
            navigator.clipboard.writeText(key).then(() => {
                showMessage(`üìã –ö–ª—é—á —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ: ${key}`);
            }).catch(err => {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è:', err);
                showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è', true);
            });
        }

        function refreshLicenses() {
            loadLicenses();
            showMessage('üîÑ –°–ø–∏—Å–æ–∫ –æ–Ω–æ–≤–ª–µ–Ω–æ!');
        }

        function testServer() {
            fetch('/')
                .then(response => response.json())
                .then(data => {
                    showMessage(`‚úÖ –°–µ—Ä–≤–µ—Ä –ø—Ä–∞—Ü—é—î: ${data.message}`);
                })
                .catch(error => {
                    showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º', true);
                });
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', function() {
            loadLicenses();
            console.log('TIR Bot Admin Panel loaded');
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
        setInterval(loadLicenses, 30000);
    </script>
</body>
</html>
